<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:of="http://omnifaces.org/functions">    

    <p:dialog header="#{etiquetas['dig.creacion.lbl.busquedaSede.tit']}" 
              widgetVar="searchSedeDialog" resizable="false" id="searchSedeDialog"  
              showEffect="fade" hideEffect="explode" modal="true" closable="true">    
        <h:form id="formBuscarSede"> 
            <h:panelGrid id="pnlBuscarSede" columns="1" cellspacing="10" >           
                <p:tabView id="tabGroup">
                    <p:tab title="#{of:abbreviate(etiquetas['consulta.basica.lbl.geo'], usuarioSesion.longitudItemOmnifaces('TOOLTIP'))}">
                        <p:panel id="panelDivGeografica" header="#{etiquetas['consulta.basica.lbl.geo']}">
                            <h:panelGrid columns="2">
                                <p:outputLabel value="#{busquedaSede.listaNivelesConf[1]}" for="nivel1" 
                                               rendered="#{busquedaSede.activoNivel1}" styleClass="lbl-h2-digitacion"/> 
                                <p:selectOneMenu id="nivel1" 
                                                 rendered="#{busquedaSede.activoNivel1}"
                                                 value="#{busquedaSede.seleccionNivel1}" >
                                    <f:selectItem itemLabel="" itemValue="#{null}"/>  
                                    <f:selectItems value="#{busquedaSede.listaNivel1}"                                                      
                                                   var="item" itemValue="#{item}" itemLabel="#{of:abbreviate(item.descripcion, usuarioSesion.longitudItemOmnifaces('COMBO'))}"/>
                                    <p:ajax update="panelDivGeografica" listener="#{busquedaSede.cambioNivel1}"/>
                                    <f:converter converterId="omnifaces.SelectItemsConverter"/>
                                </p:selectOneMenu> 

                                <p:outputLabel value="#{busquedaSede.listaNivelesConf[2]}" for="nivel2"
                                               rendered="#{busquedaSede.activoNivel2}" styleClass="lbl-h2-digitacion"/> 
                                <p:selectOneMenu id="nivel2" 
                                                 rendered="#{busquedaSede.activoNivel2}"
                                                 disabled="#{busquedaSede.seleccionNivel1 eq null}"
                                                 value="#{busquedaSede.seleccionNivel2}">
                                    <f:selectItem itemLabel="" itemValue="#{null}"/>  
                                    <f:selectItems value="#{busquedaSede.listaNivel2}"                                                      
                                                   var="item" itemValue="#{item}" itemLabel="#{of:abbreviate(item.descripcion, usuarioSesion.longitudItemOmnifaces('COMBO'))}"/>
                                    <p:ajax update="panelDivGeografica" listener="#{busquedaSede.cambioNivel2}"/>
                                    <f:converter converterId="omnifaces.SelectItemsConverter"/>
                                </p:selectOneMenu> 

                                <p:outputLabel value="#{busquedaSede.listaNivelesConf[3]}" for="nivel3"
                                               rendered="#{busquedaSede.activoNivel3}" styleClass="lbl-h2-digitacion"/> 
                                <p:selectOneMenu id="nivel3" 
                                                 rendered="#{busquedaSede.activoNivel3}"
                                                 disabled="#{busquedaSede.seleccionNivel2 eq null}"
                                                 value="#{busquedaSede.seleccionNivel3}">
                                    <f:selectItem itemLabel="" itemValue="#{null}"/>  
                                    <f:selectItems value="#{busquedaSede.listaNivel3}"                                                      
                                                   var="item" itemValue="#{item}" itemLabel="#{of:abbreviate(item.descripcion, usuarioSesion.longitudItemOmnifaces('COMBO'))}"/>
                                    <p:ajax update="panelDivGeografica" listener="#{busquedaSede.cambioNivel3}"/>  
                                    <f:converter  converterId="omnifaces.SelectItemsConverter"/>
                                </p:selectOneMenu>                                   

                                <p:outputLabel value="#{busquedaSede.listaNivelesConf[4]}" for="nivel4" 
                                               rendered="#{busquedaSede.activoNivel4}" styleClass="lbl-h2-digitacion"/> 
                                <p:selectOneMenu id="nivel4" 
                                                 rendered="#{busquedaSede.activoNivel4}"
                                                 disabled="#{busquedaSede.seleccionNivel3 eq null}"
                                                 value="#{busquedaSede.seleccionNivel4}">
                                    <f:selectItem itemLabel="" itemValue="#{null}"/>  
                                    <f:selectItems value="#{busquedaSede.listaNivel4}"                                                      
                                                   var="item" itemValue="#{item}" itemLabel="#{of:abbreviate(item.descripcion, usuarioSesion.longitudItemOmnifaces('COMBO'))}"/>
                                    <p:ajax update="panelDivGeografica" listener="#{busquedaSede.cambioNivel4}"/> 
                                    <f:converter converterId="omnifaces.SelectItemsConverter"/> 
                                </p:selectOneMenu> 

                                <p:outputLabel value="#{busquedaSede.listaNivelesConf[5]}" for="nivel4" 
                                               rendered="#{busquedaSede.activoNivel5}" styleClass="lbl-h2-digitacion"/> 
                                <p:selectOneMenu id="nivel5" 
                                                 rendered="#{busquedaSede.activoNivel5}"
                                                 disabled="#{busquedaSede.seleccionNivel4 eq null}"
                                                 value="#{busquedaSede.seleccionNivel5}">
                                    <f:selectItem itemLabel="" itemValue="#{null}"/>  
                                    <f:selectItems value="#{busquedaSede.listaNivel5}"                                                      
                                                   var="valor" itemValue="#{valor}" itemLabel="#{of:abbreviate(valor.descripcion, usuarioSesion.longitudItemOmnifaces('COMBO'))}"/>
                                    <p:ajax update="panelDivGeografica" listener="#{busquedaSede.cambioNivel5}"/>
                                    <f:converter converterId="omnifaces.SelectItemsConverter"/>
                                </p:selectOneMenu> 

                                <p:outputLabel value="#{etiquetas['consulta.basica.lbl.establecimiento']}" for="establecimiento" styleClass="lbl-h2-digitacion"/> 
<p:selectOneMenu id="establecimiento" 
                                                 disabled="#{busquedaSede.ultimoNivelDPA eq null}"
                                                 value="#{busquedaSede.seleccionEst}">
                                    <f:selectItem itemLabel="" itemValue="#{null}"/>  
                                    <f:selectItems value="#{busquedaSede.listaEstablecimientos}"                                                      
                                                   var="item" itemValue="#{item}" itemLabel="#{of:abbreviate(item.nombre, 80)}"/>
                                    <p:ajax update="sede" listener="#{busquedaSede.cambioEstablecimiento}"/>
                                    <f:converter converterId="omnifaces.SelectItemsConverter"/>
                                </p:selectOneMenu>
                                
                                

                                <p:outputLabel value="#{etiquetas['consulta.basica.lbl.sede']}" for="sede" styleClass="lbl-h2-digitacion"/> 
                                <p:selectOneMenu id="sede"
                                                 disabled="#{busquedaSede.seleccionEst eq null}"
                                                 value="#{busquedaSede.seleccionSede}" >
                                    <f:selectItem itemLabel="" itemValue="#{null}"/>  
                                    <f:selectItems value="#{busquedaSede.listaSedes}"                                                      
                                                   var="item" itemValue="#{item}" itemLabel="#{of:abbreviate(item.nombre, usuarioSesion.longitudItemOmnifaces('COMBO'))}"/>
                                    <f:converter converterId="omnifaces.SelectItemsConverter"/>
                                </p:selectOneMenu> 


                            </h:panelGrid>   
                        </p:panel>

                        <p:panelGrid columns="3">
                            <p:commandButton styleClass="btn-success" value="#{etiquetas['sede.asignar']}" oncomplete="searchSedeDialog.hide()"  
                                             action="#{digitarInstrumentoEstatico.obtenerInfoSede(busquedaSede.seleccionSede)}"
                                             update=":formAgregarEstablecimientos,:formBuscarSede">
                            </p:commandButton>


                            <p:commandButton styleClass="btn-danger" value="#{etiquetas['aplicacion.general.cancelar']}" 
                                             update="tabGroup" process="@this" oncomplete="searchSedeDialog.hide()"  >  
                                <p:resetInput target="tabGroup" />  
                            </p:commandButton>           
                        </p:panelGrid>

                        <p:messages id="messages" showDetail="true" closable="true" autoUpdate="true"/> 
                    </p:tab>

                    <p:tab title="#{of:abbreviate(etiquetas['predio.establecimiento'], usuarioSesion.longitudItemOmnifaces('TOOLTIP'))}">
                        <p:outputLabel value="#{etiquetas['aplicacion.general.codEst']}" for="codEst" styleClass="lbl-h2-digitacion"/> 
                        <p:inputText id="codEst" value="#{busquedaSede.codEstablecimiento}" 
                                     label="codEst" />
                        <p:commandButton styleClass="btn-success" value="#{etiquetas['aplicacion.general.consultar']}"
                                         action="#{busquedaSede.consultarSedesPorEstablecimiento}"
                                         update="resulConsulta">
                        </p:commandButton> 

                        <p:dataTable id="resulConsulta" var="sede" value="#{busquedaSede.sedesEncontradas}"
                                     scrollable="true" style="max-width: 600px;" 
                                     emptyMessage="#{etiquetas['aplicacion.general.noExistenRegistros']}"> 

                            <p:column sortBy="#{sede.codigo}"> 
                                <f:facet name="header">  
                                    <h:outputText value="#{etiquetas['aplicacion.general.codEst']}" />  
                                </f:facet>  
                                <h:outputText value="#{sede.codigo}" />  
                            </p:column>

                            <p:column sortBy="#{sede.nombre}"> 
                                <f:facet name="header">  
                                    <h:outputText value="#{etiquetas['aplicacion.general.nomEst']}" />  
                                </f:facet>  
                                <h:outputText value="#{sede.nombre}" />  
                            </p:column>

                            <p:column> 
                                <p:commandButton styleClass="btn-success" value="#{etiquetas['sede.asignar']}" oncomplete="searchSedeDialog.hide()"  
                                                 action="#{digitarInstrumentoEstatico.obtenerInfoSede(sede)}"
                                                 update=":formAgregarEstablecimientos,:formBuscarSede">
                                    <p:resetInput target=":formBuscarSede:pnlBuscarSede" />
                                </p:commandButton>
                            </p:column>

                            <f:facet name="footer" class="footerTabla">  
                                <h:outputText value="#{etiquetas['aplicacion.general.total.registros']} #{busquedaSede.sedesEncontradas.size()}" />  
                            </f:facet>
                        </p:dataTable>
                    </p:tab>
                </p:tabView>
            </h:panelGrid>

        </h:form> 
    </p:dialog>   

</ui:composition>